<!DOCTYPE html>
<html>
<head>
    <title>Devjourfix Special</title>
    <link crossorigin="anonymous" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" rel="stylesheet">
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
</head>
<body>
<div class="container">
    <h2>Task 2</h2>
    <p>
        <a href="https://devjourfix-willhaben-test.auth.eu-central-1.amazoncognito.com/login?response_type=code&redirect_uri=https://s3.eu-central-1.amazonaws.com/wh-oauth-workshop/solution/solution-html/solution-2.html&scope=openid+devjourfix.willhaben.test/devjourfix+devjourfix.willhaben.test/final&client_id=5vkkniseds4i1s4pst0uoe280u">
        <button class="btn btn-primary" type="button">
            Login Task 2
        </button>
    </a>
    </p>
    <table class="table">
        <tr>
            <td>code</td>
            <td><code id="task2c"/></td>
        </tr>
        <tr>
            <td>request</td>
            <td><code id="task2cr"></code></td>
        </tr>

        <tr>
            <td>access_token</td>
            <td><code id="task2a"/></td>
        </tr>

        <tr>
            <td>next level</td>
            <td><code id="result"></code></td>
        </tr>

    </table>
    <script>
        let code = new URLSearchParams(window.location.search).get('code')
        window.document.getElementById('task2c').innerText = code
        window.document.getElementById('task2cr').innerText = "curl 'https://devjourfix-willhaben-test.auth.eu-central-1.amazoncognito.com/oauth2/token' -H 'Authorization: Basic NXZra25pc2VkczRpMXM0cHN0MHVvZTI4MHU6MXIxbGtxZWE1dHVoNHNjbTdsa2Q0Mm1jbDMycGdyYnBraW01Z3ZzcDZidmduZTdlNTVmNw==' -H 'Content-Type: application/x-www-form-urlencoded' --data 'code=762cba4b-2309-4789-bee8-ffd5084513af&grant_type=authorization_code&client_id=5vkkniseds4i1s4pst0uoe280u&redirect_uri=https://s3.eu-central-1.amazonaws.com/wh-oauth-workshop/solution/solution-html/solution-2.html'"
        fetch('https://devjourfix-willhaben-test.auth.eu-central-1.amazoncognito.com/oauth2/token', {
            body: 'code=' + code + '&grant_type=authorization_code&client_id=5vkkniseds4i1s4pst0uoe280u&redirect_uri=https://s3.eu-central-1.amazonaws.com/wh-oauth-workshop/solution/solution-html/solution-2.html',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'Authorization': 'Basic NXZra25pc2VkczRpMXM0cHN0MHVvZTI4MHU6MXIxbGtxZWE1dHVoNHNjbTdsa2Q0Mm1jbDMycGdyYnBraW01Z3ZzcDZidmduZTdlNTVmNw=='
            },
            method: 'post',
        }).then(response => response.json())
            .then(result => {
                window.document.getElementById('task2a').innerText = result.access_token
                window.document.getElementById('result').innerText = "curl --header \"Authorization: Bearer "
                    + result.access_token+"\" https://5ddwj6qy0l.execute-api.eu-central-1.amazonaws.com/prod/task2"

            })


    </script>
</div>
</body>

</html>

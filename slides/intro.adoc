:customcss: custom.css

# OAuth 2.0 workshop

## About me

Matthias Kausl

Team lead and Java dev @ willhaben

blog: https://tech.willhaben.at/[tech.willhaben.at]

twitter: @willhabentech

## Motivation

* currently implementing OAuth 2.0 @willhaben
** not everyone had knowledge about it
* lots of frameworks that implement OAuth 2.0
** look "under the hood" to understand it better

## Non Goals

* become an OAuth expert
* implement your own framework

## Goal

understand how these work

image:login-buttons.png[login]


## Agenda

* Very brief introduction to OAuth/OpenID connect
* Coding challenge

## What is OAuth 2.0?

OAuth 2.0 is a *authorization framework*

## What is OAuth 2.0?

It defines how a *client* application can + 
obtain *authorization* from a *user* + 
to access a *resource* on her behalf

## Vocabulary
[cols="1,6"]
|===
| *client* | application (e.g. java web applicaiton, angular spa, this slide deck, ...)
| *resource* | something only the user has access to (e.g. REST API accessing your google calendar)
| *authorization* | something that proves that you are allowed to access a resource (e.g. Bearer token)
|===


## Example

Imagine *this slide deck* (the client) + 
wants to *access* (obtain authorization) + 
*my google calendar* (resource).

[.fragment]
https://accounts.google.com/o/oauth2/v2/auth?client_id=1010832371207-6lg7vjf685teluei2aalmmudsm7a0m5j.apps.googleusercontent.com&redirect_uri=http://localhost&response_type=token&scope=https://www.googleapis.com/auth/calendar.readonly[Login]

## Grant types

The steps needed to get the access token are defined in so called *grant types*.

In this workshop we will look at two grant types:

* Authorization Code
* Implicit

## Authorization Code Grant

     +----------+
     | Resource |
     |   Owner  |
     +----------+
          ^
         (B)
     +----|-----+          Client Identifier      +---------------+
     |         -+----(A)-- & Redirection URI ---->|               |
     |  User-   |                                 | Authorization |
     |  Agent  -+----(B)-- User authenticates --->|     Server    |
     |          |                                 |               |
     |         -+----(C)-- Authorization Code ---<|               |
     +-|----|---+                                 +---------------+
      (A)  (C)                                        |      |
       ^    v                                         |      |
     +---------+                                      |      |
     |         |>---(D)-- Authorization Code ---------'      |
     |  Client |          & Redirection URI                  |
     |         |<---(E)----- Access Token -------------------'
     +---------+       (w/ Optional Refresh Token)

## Implicit Grant

     
 +----------+     +----------+          Client Identifier     +---------------+
 | Resource |--B->|         -+----(A)-- & Redirection URI --->|               |
 |  Owner   |     |  User-   |                                | Authorization |
 |          |     |  Agent  -|----(B)-- User authenticates -->|     Server    |
 +----------+     |          |                                |               |
                  |          |<---(C)--- Redirection URI ----<|               |
                  |          |          with Access Token     +---------------+
                  |          |            in Fragment
                  |          |                                +---------------+
                  |          |----(D)--- Redirection URI ---->|   Web-Hosted  |
  +---------+     |          |          without Fragment      |     Client    |
  |         |--A->|          |                                |    Resource   |
  |  Client |     |     (F)  |<---(E)------- Script ---------<|               |
  |         |<-G--|          |                                +---------------+
  +---------+     +----------+
     (G) Access Token

## OpenID connect

* adds *authentication* on top of OAuth 2.0
** remember: OAuth 2.0 is a *authorization framework*
* removes some ambiguities

## Lets start coding

You need

* your laptop (any editor, IDE, ...)
* internet access + a browser
* a tool for making HTTP requests (curl, postman, ...)
* a local webserver serving from port 8080 (`http://locahost:8080`) 


## Lets start coding

to start access the following URL in your browser:

https://5ddwj6qy0l.execute-api.eu-central-1.amazonaws.com/prod

## Solution 1

.Query Parameters
|===

|`client_id` | `3can53th3tlmsnhcn1buji30i8`

|`redirect_uri` | `http://localhost:8080/callback`

|`scope` | openid

|`response_type` | token

|===

 https://.../oauth2/authorize
 ?response_type=token
 &redirect_uri=http://localhost:8080/callback
 &scope=openid
 &client_id=3can53th3tlmsnhcn1buji30i8


## Solution 2

### Request 1

.Query Parameters
|===

|`client_id` | `5vkkniseds4i1s4pst0uoe280u`

|`redirect_uri` | `http://localhost:8080/callback`

|`scope` |  `openid devjourfix.willhaben.test/devjourfix`

|`response_type` | code |

|===

 https://.../login
 ?response_type=code
 &redirect_uri=http://localhost:8080/callback
 &scope=openid+devjourfix.willhaben.test/devjourfix+devjourfix.willhaben.test/final
 &client_id=5vkkniseds4i1s4pst0uoe280u">

## Solution 2

### Request 2

 POST
 https://devjourfix-willhaben-test.auth.eu-central-1.amazoncognito.com/oauth2/token

 Headers
 Content-Type: 'application/x-www-form-urlencoded'
 Authorization: Base64Encode(client_id + ':' + client_secret)

 code=xxxxx
 grant_type=authorization_code
 client_id=5vkkniseds4i1s4pst0uoe280u
 redirect_uri=http://localhost:8080/callback

## Solution 3

 POST
 https://devjourfix-willhaben-test.auth.eu-central-1.amazoncognito.com/oauth2/token

 Headers
 Content-Type: 'application/x-www-form-urlencoded'
 Authorization: Base64Encode(client_id + ':' + client_secret)

 refresh_token=xxxxx
 grant_type=refresh_token
 client_id=5vkkniseds4i1s4pst0uoe280u
